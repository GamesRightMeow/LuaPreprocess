<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta content="width=device-width, initial-scale=1" name="viewport">
		<meta content="LuaWebGen 1.5.0" name="generator">

		<meta content="Official website for LuaPreprocess - the small and straightforward Lua preprocessor with simple syntax." name="description">

		<meta content="website" name="og:type">
		<meta content="Documentation - LuaPreprocess" name="og:title">
		<meta content="Official website for LuaPreprocess - the small and straightforward Lua preprocessor with simple syntax." name="og:description">

		<meta content="http://refreezed.com/luapreprocess/logo.png" name="og:image">

		<meta content="http://refreezed.com/luapreprocess/docs/" name="og:url">
		<meta content="en_US" name="og:locale">
		<meta content="LuaPreprocess" name="og:site_name">

		<title>Documentation - LuaPreprocess</title>

		<link href="http://refreezed.com/luapreprocess/docs/" rel="canonical">
		<link href="/style.css" rel="stylesheet">
		<link href="/luapreprocess/favicon.ico" rel="shortcut icon" type="image/x-icon">

		<script src="/main.js"></script>
	</head>

	<body data-site="luapreprocess">
		<header>

				<div id="home">
					<a href="/">« ReFreezed.com</a>
				</div>

			<a class="siteFront" href="/luapreprocess/"><img alt="LuaPreprocess" class="limitSize" height="126" src="/luapreprocess/logo.png" width="600"></a>
		</header>

		<nav id="main-navigation">

				<ul>

							<li><a href="/luapreprocess/">About</a></li>

							<li><a href="https://github.com/ReFreezed/LuaPreprocess/releases/latest">Download</a></li>

							<li><strong>Documentation</strong></li>

							<li><a href="/luapreprocess/highlight/">Highlighter</a></li>

							<li><a href="https://github.com/ReFreezed/LuaPreprocess/issues">Issue Tracker</a></li>

							<li><a href="https://github.com/ReFreezed/LuaPreprocess">Source</a></li>

				</ul>

		</nav>

		<div class="middleOuter"><div class="middleInner">

	<nav id="sidebar"><div>
		<input id="hideTopics" role="button" style="display:none;" type="checkbox">
		<script>{
			let checkbox     = document.getElementById("hideTopics");
			checkbox.checked = (localStorageGet("docs_topicsHidden") === "1");

			checkbox.addEventListener("change", function(e) {
				if (checkbox.checked)  localStorageSet("docs_topicsHidden", "1");
				else                   localStorageRemove("docs_topicsHidden");
			});
		}</script>

		<div class="title">
			<h1>Topics</h1>
			<span class="hideTopics"><label for="hideTopics"></label></span>
		</div>

		<ul class="topics">
			<li><strong>Home</strong><ul><li><a href="/luapreprocess/docs/#how-to-metaprogram">How to metaprogram</a></li><li><a href="/luapreprocess/docs/#two-ways-of-generating-code">Two ways of generating code</a></li><li><a href="/luapreprocess/docs/#potential-gotchas">Potential gotchas</a></li></ul></li><li><a href="/luapreprocess/docs/api/">API</a></li><li><a href="/luapreprocess/docs/command-line/">Command line</a><ul><li><a href="/luapreprocess/docs/command-line/#command-line-usage">Command line usage</a></li><li><a href="/luapreprocess/docs/command-line/#options">Options</a></li><li><a href="/luapreprocess/docs/command-line/#message-handlers">Message handlers</a></li><li><a href="/luapreprocess/docs/command-line/#messages">Messages</a></li><li><a href="/luapreprocess/docs/command-line/#other-info">Other info</a></li></ul></li><li><a href="/luapreprocess/docs/extra-functionality/">Extra functionality</a><ul><li><a href="/luapreprocess/docs/extra-functionality/#preprocessor-keywords">Preprocessor keywords</a></li><li><a href="/luapreprocess/docs/extra-functionality/#preprocessor-symbols">Preprocessor symbols</a></li><li><a href="/luapreprocess/docs/extra-functionality/#backtick-strings">Backtick strings</a></li></ul></li>
		</ul>
	</div></nav>

<main>

		<h1>Documentation</h1>

	<p>See the sidebar for all pages.</p>
<ul>
<li><a href="#how-to-metaprogram">How to metaprogram</a></li>
<li><a href="#two-ways-of-generating-code">Two ways of generating code</a></li>
<li><a href="#potential-gotchas">Potential gotchas</a></li>
</ul>
<hr>
<h2 id="how-to-metaprogram">How to metaprogram<a aria-hidden="true" class="anchor" href="#how-to-metaprogram"><svg height="16" viewBox="0 0 16 16" width="16"><path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z" fill-rule="evenodd"/></svg></a></h2>
<p>The exclamation mark (!) is used to indicate what code is part of the metaprogram.
There are 4 main ways to write metaprogram code:</p>
<ul>
<li>
<code>!...</code> - One exclamation mark - run a line of code.</li>
<li>
<code>!!...</code> - Two exclamation marks - output code to both the metaprogram and final program.</li>
<li>
<code>!( ... )</code> - One exclamation mark followed by parenthesis - output a value, or run a block of code.</li>
<li>
<code>!!( ... )</code> - Two exclamation marks followed by parenthesis - output lua code.</li>
</ul>
<h3><em>!...</em></h3>
<p>The line will simply run during preprocessing.
The line can span multiple physical lines if it contains brackets.</p>
<pre class="syntax-lua"><code><span class="c">-- Simple preprocessor lines.
</span><span class="p"><span class="d">!</span><span class="k">if</span> <span class="l">not</span> isDeveloper <span class="k">then</span></span>
	sendTelemetry()
<span class="p"><span class="d">!</span><span class="k">end</span></span>

<span class="c">-- Span multiple lines.
</span><span class="p"><span class="d">!</span>newClass{
	name  = <span class="s">&quot;Entity&quot;</span>,
	props = {x=<span class="n">0</span>, y=<span class="n">0</span>},
}</span>

<span class="c">-- There can be stuff before a preprocessor line.
</span><span class="k">local</span> foo = <span class="n">10</span>  <span class="p"><span class="d">!</span>print(<span class="s">&quot;We&apos;ve reached foo.&quot;</span>)</span>

<span class="c">-- Example output:
</span>sendTelemetry()

<span class="k">function</span> newEntity()
	<span class="k">return</span> {__classname=<span class="s">&quot;Entity&quot;</span>, x=<span class="n">0</span>, y=<span class="n">0</span>}
<span class="k">end</span>

<span class="k">local</span> foo = <span class="n">10</span>
</code></pre>
<h3><em>!!...</em></h3>
<p>The line will appear in both the metaprogram and the final program.
The line must be an assignment (and optionally a declaration).
The value will be evaluated in the metaprogram.</p>
<pre class="syntax-lua"><code><span class="c">-- The expression will be evaluated in the metaprogram and the
-- result will appear in the final program as a literal value.
</span><span class="p"><span class="d">!!</span><span class="k">local</span> tau     = <span class="n">2</span> * math.pi</span>
<span class="p"><span class="d">!!</span><span class="k">local</span> aAndTau = (<span class="s">&quot;a&quot;</span>):rep(<span class="n">10</span>) .. tau</span>

<span class="c">-- Output:
</span><span class="k">local</span> tau     = <span class="n">6.283185</span>
<span class="k">local</span> aAndTau = <span class="s">&quot;aaaaaaaaaa6.283185&quot;</span>
</code></pre>
<p>These two code snippets are equivalent:</p>
<pre class="syntax-lua"><code><span class="p"><span class="d">!!</span><span class="k">local</span> x = foo()</span>

<span class="p"><span class="d">!</span><span class="k">local</span> x = foo()</span>
<span class="k">local</span> x = <span class="p"><span class="d">!</span>(x)</span>
</code></pre>
<h3><em>!( ... )</em></h3>
<p>If the parenthesis contains an expression the result of the expression will be outputted as a literal value,
otherwise the code will just run as-is.</p>
<pre class="syntax-lua"><code><span class="c">-- Output values.
</span><span class="k">local</span> bigNumber = <span class="p"><span class="d">!</span>( <span class="n">5</span>^<span class="n">10</span> )</span>
<span class="k">local</span> manyAbcs  = <span class="p"><span class="d">!</span>( (<span class="s">&quot;abc&quot;</span>):rep(<span class="n">10</span>) )</span>

<span class="c">-- Run a block of code.
</span><span class="p"><span class="d">!</span>(
<span class="k">local</span> dogWord = <span class="s">&quot;Woof &quot;</span>
<span class="k">function</span> getDogText()
	<span class="k">return</span> dogWord:rep(<span class="n">3</span>)
<span class="k">end</span>
outputLua(<span class="s">&quot;dog = &quot;</span>)
outputValue(getDogText())
)</span>

<span class="c">-- Output:
</span><span class="k">local</span> bigNumber = <span class="n">9765625</span>
<span class="k">local</span> manyAbcs  = <span class="s">&quot;abcabcabcabcabcabcabcabcabcabc&quot;</span>

dog = <span class="s">&quot;Woof Woof Woof &quot;</span>
</code></pre>
<h3><em>!!( ... )</em></h3>
<p>The result of the expression in the parenthesis will be outputted as Lua code.
The result must be a string value.</p>
<pre class="syntax-lua"><code><span class="k">local</span> font = <span class="p"><span class="d">!!</span>( isDeveloper <span class="l">and</span> <span class="s">&quot;loadDevFont()&quot;</span> <span class="l">or</span> <span class="s">&quot;loadUserFont()&quot;</span> )</span>

<span class="p"><span class="d">!</span><span class="k">local</span> globals = {pi=math.pi, tau=<span class="n">2</span>*math.pi}</span>
<span class="p"><span class="d">!</span><span class="k">for</span> k, v <span class="k">in</span> pairs(globals) <span class="k">do</span></span>
	_G.<span class="p"><span class="d">!!</span>(k)</span> = <span class="p"><span class="d">!</span>(v)</span>
<span class="p"><span class="d">!</span><span class="k">end</span></span>

<span class="c">-- Example output:
</span><span class="k">local</span> font = loadUserFont()

_G.pi  = <span class="n">3.14159265358979323846</span>
_G.tau = <span class="n">6.28318530717958647693</span>
</code></pre>
<p>(Also see <a href="/luapreprocess/docs/extra-functionality/#insert-func">macros</a> and <a href="/luapreprocess/docs/extra-functionality/#preprocessor-symbols">symbols</a>.)</p>
<h2 id="two-ways-of-generating-code">Two ways of generating code<a aria-hidden="true" class="anchor" href="#two-ways-of-generating-code"><svg height="16" viewBox="0 0 16 16" width="16"><path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z" fill-rule="evenodd"/></svg></a></h2>
<p>These examples show two ways of doing the same thing using inline code and a code block.</p>
<h3 id="populate-a-table">Populate a table<a aria-hidden="true" class="anchor" href="#populate-a-table"><svg height="16" viewBox="0 0 16 16" width="16"><path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z" fill-rule="evenodd"/></svg></a></h3>
<pre class="syntax-lua"><code><span class="c">-- Using inline code.
</span><span class="k">local</span> oddNumbers = {
	<span class="p"><span class="d">!</span><span class="k">for</span> v = <span class="n">1</span>, <span class="n">5</span>, <span class="n">2</span> <span class="k">do</span></span>
		<span class="p"><span class="d">!</span>( v )</span>,
	<span class="p"><span class="d">!</span><span class="k">end</span></span>
}

<span class="c">-- Using a code block.
</span><span class="p"><span class="d">!</span>(
outputLua(<span class="s">&quot;local oddNumbers = {</span><span class="n">\n</span><span class="s">&quot;</span>)
<span class="k">for</span> v = <span class="n">1</span>, <span class="n">5</span>, <span class="n">2</span> <span class="k">do</span>
	outputLua(<span class="s">&quot;</span><span class="n">\t</span><span class="s">&quot;</span>)
	outputValue(v)
	outputLua(<span class="s">&quot;,</span><span class="n">\n</span><span class="s">&quot;</span>)
<span class="k">end</span>
outputLua(<span class="s">&quot;}&quot;</span>)
)</span>

<span class="c">-- Output:
</span><span class="k">local</span> oddNumbers = {
	<span class="n">1</span>,
	<span class="n">3</span>,
	<span class="n">5</span>,
}
</code></pre>
<h3 id="generate-a-pattern">Generate a pattern<a aria-hidden="true" class="anchor" href="#generate-a-pattern"><svg height="16" viewBox="0 0 16 16" width="16"><path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z" fill-rule="evenodd"/></svg></a></h3>
<pre class="syntax-lua"><code><span class="c">-- Using inline code.
</span><span class="p"><span class="d">!</span><span class="k">local</span> alpha        = <span class="s">&quot;[</span><span class="n">%a</span><span class="s">_]&quot;</span></span>
<span class="p"><span class="d">!</span><span class="k">local</span> alphaNumeric = <span class="s">&quot;[</span><span class="n">%w</span><span class="s">_]&quot;</span></span>
<span class="k">local</span> identifierPattern = <span class="p"><span class="d">!</span>( <span class="s">&quot;^&quot;</span>..alpha..alphaNumeric..<span class="s">&quot;*$&quot;</span> )</span>

<span class="c">-- Using a code block.
</span><span class="p"><span class="d">!</span>(
<span class="k">local</span> alpha        = <span class="s">&quot;[</span><span class="n">%a</span><span class="s">_]&quot;</span>
<span class="k">local</span> alphaNumeric = <span class="s">&quot;[</span><span class="n">%w</span><span class="s">_]&quot;</span>
outputLua(<span class="s">&quot;local identifierPattern = &quot;</span>)
outputValue(<span class="s">&quot;^&quot;</span>..alpha..alphaNumeric..<span class="s">&quot;*$&quot;</span>)
)</span>

<span class="c">-- Output:
</span><span class="k">local</span> identifierPattern = <span class="s">&quot;^[</span><span class="n">%a</span><span class="s">_][</span><span class="n">%w</span><span class="s">_]*$&quot;</span>
</code></pre>
<h2 id="potential-gotchas">Potential gotchas<a aria-hidden="true" class="anchor" href="#potential-gotchas"><svg height="16" viewBox="0 0 16 16" width="16"><path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z" fill-rule="evenodd"/></svg></a></h2>
<p>Beware in code blocks that only call a single function:</p>
<pre class="syntax-lua"><code><span class="c">-- This will bee seen as an inline block and output whatever value
-- func() returns as a literal.
</span><span class="p"><span class="d">!</span>( func() )</span>

<span class="c">-- If that&apos;s not wanted then a trailing &quot;;&quot; will prevent that.
-- This line won&apos;t output anything (unless func() calls outputLua()
-- or outputValue()).
</span><span class="p"><span class="d">!</span>( func(); )</span>

<span class="c">-- When the full metaprogram is generated, `!(func())` translates
-- into `outputValue(func())` while `!(func();)` simply translates
-- into `func();` (because `outputValue(func();)` would be invalid
-- Lua code).
</span>
<span class="c">-- Anyway, in this specific case a preprocessor line (without the
-- parenthesis) would be nicer:
</span><span class="p"><span class="d">!</span>func()</span>
</code></pre>

	<p style="margin-top: 4rem;">
		<small>Page updated: 2022-07-08</small>
	</p>
</main>

		</div></div>

		<footer>Copyright © 2009-2022 <a href="http://marcus.refreezed.com/">Marcus &apos;ReFreezed&apos; Thunström</a></footer>
	</body>
</html>